# Быстрое решение: Добавление домашней сети клиента в AllowedIPs

## Проблема

Нужно добавить домашнюю сеть клиента (например, `192.168.77.0/24`) в AllowedIPs на сервере, чтобы другие клиенты могли обращаться к устройствам в этой сети через VPN.

## Быстрое решение

### Вариант 1: Использовать скрипт (рекомендуется)

```bash
cd /home/wg_client_tui_genarator/wiregurad_on_debian_13_with_tui_peers_generator
chmod +x wg-update-peer-allowedips.sh
./wg-update-peer-allowedips.sh
```

Скрипт:
1. Покажет список всех пиров
2. Попросит ввести PublicKey пира (например, `uldAjVywUbjTxIPvxn133x8OwgGdTyBLw+9eHS4IfGk=`)
3. Покажет текущие AllowedIPs
4. Попросит ввести новые AllowedIPs: `10.77.0.2/32, 0.0.0.0/0, 192.168.77.0/24`
5. Автоматически обновит конфигурацию и применит изменения

### Вариант 2: Ручное редактирование

```bash
# Отредактировать конфигурацию
nano /etc/wireguard/wg0.conf

# Найти секцию [Peer] для пира anton_sevnet и изменить:
# Было:
# AllowedIPs = 10.77.0.2/32
#
# Стало:
# AllowedIPs = 10.77.0.2/32, 0.0.0.0/0, 192.168.77.0/24

# Применить изменения без перезапуска
wg set wg0 peer uldAjVywUbjTxIPvxn133x8OwgGdTyBLw+9eHS4IfGk= allowed-ips 10.77.0.2/32,0.0.0.0/0,192.168.77.0/24

# Или перезапустить WireGuard
wg-quick down wg0 && wg-quick up wg0
```

## Пример для пира anton_sevnet

**Текущая конфигурация на сервере:**
```ini
[Peer]
# Публичный ключ пира: anton_sevnet
PublicKey = uldAjVywUbjTxIPvxn133x8OwgGdTyBLw+9eHS4IfGk=
AllowedIPs = 10.77.0.2/32
```

**Обновленная конфигурация:**
```ini
[Peer]
# Публичный ключ пира: anton_sevnet
PublicKey = uldAjVywUbjTxIPvxn133x8OwgGdTyBLw+9eHS4IfGk=
AllowedIPs = 10.77.0.2/32, 0.0.0.0/0, 192.168.77.0/24
```

## Важные замечания

1. **Конфликты IP:** Убедитесь, что `192.168.77.0/24` не конфликтует с VPN сетью (`10.77.0.0/24`) или другими сетями.

2. **Безопасность:** Добавление домашней сети означает, что другие клиенты VPN смогут обращаться к этой сети (если у них есть соответствующие маршруты).

3. **Маршрутизация на клиенте:** На клиенте может потребоваться настроить маршрутизацию для доступа к домашней сети через VPN.

## Проверка

После применения изменений проверьте:

```bash
# Проверить текущие AllowedIPs для пира
wg show wg0 | grep -A 5 "uldAjVywUbjTxIPvxn133x8OwgGdTyBLw+9eHS4IfGk="

# Попробовать пинговать устройство в домашней сети (с другого клиента или сервера)
ping 192.168.77.1
```

## Дополнительная информация

Подробная информация доступна в файлах:
- `README_CLIENT_HOME_NETWORK.md` - полное руководство по настройке доступа к домашней сети
- `README_PERSISTENT_KEEPALIVE.md` - объяснение про PersistentKeepalive

